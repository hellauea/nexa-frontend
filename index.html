<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- interactive-widget=resizes-content fixes the keyboard covering input on Android -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content" />
  <title>NEXA | Intelligent Assistant</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs2015.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #020617;
      /* Prevent background scrolling */
      position: fixed; 
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* Aurora Background */
    .aurora-bg {
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 50% 50%, rgba(76, 29, 149, 0.15), transparent 50%),
                  radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.15), transparent 50%),
                  radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.15), transparent 50%);
      animation: aurora 20s ease-in-out infinite alternate;
      z-index: -1;
    }

    @keyframes aurora {
      0% { transform: translate(0, 0) rotate(0deg); }
      100% { transform: translate(-5%, -5%) rotate(5deg); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    /* Typing Dots */
    .typing-dot { animation: wave 1.5s infinite ease-in-out; }
    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes wave {
      0%, 100% { transform: translateY(0); opacity: 0.5; }
      50% { transform: translateY(-5px); opacity: 1; }
    }

    /* Listening Pulse */
    @keyframes pulse-red {
      0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }
    .listening-mode {
      color: #ef4444 !important;
      animation: pulse-red 1.5s infinite;
    }

    /* Markdown Styles */
    .prose p { margin-bottom: 0.75em; line-height: 1.7; }
    .prose pre { background: #1e1e1e !important; border-radius: 0.75rem; border: 1px solid #333; margin: 1em 0; }
    .prose code { color: #e0e7ff; font-family: monospace; background: rgba(255,255,255,0.1); padding: 0.2em 0.4em; border-radius: 4px; }
    .prose strong { color: #a5b4fc; font-weight: 600; }
    
    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .message-enter { animation: fadeIn 0.4s ease-out forwards; }
    .force-hidden { display: none !important; }
  </style>
</head>
<!-- Body uses height: 100dvh to act like a native app on mobile -->
<body class="text-slate-200 selection:bg-indigo-500/30 selection:text-indigo-200 md:flex md:items-center md:justify-center">

  <div class="aurora-bg"></div>

  <!-- Main Interface Container 
       Mobile: Full width/height (w-full h-full), no rounding.
       Desktop (md): Fixed size (max-w-5xl h-[90vh]), rounded corners. 
  -->
  <div class="w-full h-full md:h-[90vh] md:max-w-5xl flex flex-col bg-slate-900/60 backdrop-blur-xl md:rounded-3xl md:shadow-2xl md:border md:border-white/10 relative overflow-hidden transition-all">
    
    <!-- Header -->
    <header class="px-4 md:px-8 py-4 border-b border-white/5 flex items-center justify-between bg-slate-900/40 z-20 shrink-0">
      <div class="flex items-center gap-3">
         <h1 class="text-xl md:text-2xl font-bold tracking-tight text-white">NEXA</h1>
      </div>
      
      <button onclick="location.reload()" class="w-9 h-9 rounded-full hover:bg-white/5 flex items-center justify-center text-slate-400 transition-all">
        <i class="fa-solid fa-plus"></i>
      </button>
    </header>

    <!-- Chat Area -->
    <div id="chat" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-6 scroll-smooth">
      <!-- Welcome Screen -->
      <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center space-y-6">
        <div class="w-16 h-16 md:w-20 md:h-20 rounded-3xl bg-gradient-to-tr from-blue-600 via-indigo-600 to-purple-600 p-[1px] shadow-2xl shadow-indigo-500/20">
          <div class="w-full h-full bg-slate-900/90 rounded-3xl flex items-center justify-center backdrop-blur-sm">
             <i class="fa-solid fa-bolt text-2xl md:text-3xl text-transparent bg-clip-text bg-gradient-to-tr from-blue-400 to-purple-400"></i>
          </div>
        </div>
        <div>
          <h2 class="text-2xl md:text-4xl font-bold text-white mb-2">Hello, Human.</h2>
          <p class="text-slate-400 text-sm md:text-lg max-w-md mx-auto">How can I help you today?</p>
        </div>
        
        <div class="flex flex-wrap justify-center gap-2 mt-4 px-4">
          <button onclick="fillInput('Analyze this code for vulnerabilities')" class="px-3 py-2 rounded-full bg-white/5 border border-white/5 text-xs md:text-sm text-slate-300">üõ°Ô∏è Security Audit</button>
          <button onclick="fillInput('Write a Python script')" class="px-3 py-2 rounded-full bg-white/5 border border-white/5 text-xs md:text-sm text-slate-300">üêç Python Script</button>
        </div>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div id="typing-indicator" class="hidden px-6 py-2 items-center gap-2 text-slate-400 shrink-0">
      <div class="w-2 h-2 bg-indigo-500 rounded-full typing-dot"></div>
      <div class="w-2 h-2 bg-violet-500 rounded-full typing-dot"></div>
      <div class="w-2 h-2 bg-fuchsia-500 rounded-full typing-dot"></div>
    </div>

    <!-- Input Area -->
    <div class="p-4 md:p-6 bg-gradient-to-t from-slate-950 via-slate-900/95 to-transparent z-20 shrink-0">
      <form id="chat-form" class="relative max-w-3xl mx-auto">
        <div class="relative group">
          <!-- Mobile-friendly input container -->
          <div class="relative flex items-center bg-slate-800/80 md:bg-slate-950 rounded-full md:rounded-2xl border border-white/10 shadow-lg">
            
            <input 
              id="user-input" 
              type="text" 
              placeholder="Ask anything..." 
              class="w-full bg-transparent text-white py-3 md:py-4 pl-5 pr-24 rounded-full md:rounded-2xl focus:outline-none placeholder-slate-500 text-base"
              autocomplete="off"
            />
            
            <!-- Buttons -->
            <div class="absolute right-1.5 md:right-2 flex items-center gap-1">
              <!-- Mic Button -->
              <button type="button" id="mic-btn" class="p-2.5 text-slate-400 hover:text-white rounded-full transition-all active:scale-95" title="Voice Input">
                <i class="fa-solid fa-microphone"></i>
              </button>
              
              <!-- Send Button -->
              <button type="submit" class="p-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-full transition-all shadow-lg shadow-indigo-500/20 active:scale-95">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
            </div>
            
          </div>
        </div>
        <p class="hidden md:block text-center text-xs text-slate-600 mt-2">NEXA can make mistakes. Please verify critical information.</p>
      </form>
    </div>

  </div>

<script>
const API_URL = "https://nexa-ai-nd5x.onrender.com/ask";
let conversation = [];

const chatContainer = document.getElementById('chat');
const welcomeScreen = document.getElementById('welcome-screen');
const typingIndicator = document.getElementById('typing-indicator');
const micBtn = document.getElementById('mic-btn');
const userInput = document.getElementById('user-input');

// --- Speech Recognition Logic ---
let recognition;
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'en-US';

    recognition.onstart = () => {
        micBtn.classList.add('listening-mode');
        userInput.placeholder = "Listening...";
    };

    recognition.onend = () => {
        micBtn.classList.remove('listening-mode');
        userInput.placeholder = "Ask anything...";
    };

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        userInput.focus();
    };

    recognition.onerror = (event) => {
        micBtn.classList.remove('listening-mode');
        userInput.placeholder = "Error. Try again.";
    };

    micBtn.addEventListener('click', () => {
        if (micBtn.classList.contains('listening-mode')) {
            recognition.stop();
        } else {
            recognition.start();
        }
    });
} else {
    micBtn.style.display = 'none';
}

function fillInput(text) {
  const input = document.getElementById('user-input');
  input.value = text;
  input.focus();
}

marked.setOptions({
  highlight: function(code, lang) {
    const language = highlight.getLanguage(lang) ? lang : 'plaintext';
    return highlight.highlight(code, { language }).value;
  },
  langPrefix: 'hljs language-'
});

function scrollToBottom() {
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showTyping() {
    typingIndicator.classList.remove('hidden');
    typingIndicator.classList.add('flex');
    scrollToBottom();
}

function hideTyping() {
    typingIndicator.classList.add('hidden');
    typingIndicator.classList.remove('flex');
}

function addMessage(text, sender) {
  if (welcomeScreen) welcomeScreen.style.display = 'none';

  const div = document.createElement('div');
  const isBot = sender === 'bot';
  
  div.className = `flex w-full ${isBot ? 'justify-start' : 'justify-end'} message-enter mb-6 md:mb-8`;
  
  const content = isBot ? marked.parse(text) : text;

  div.innerHTML = `
    <div class="flex flex-col max-w-[90%] md:max-w-[75%] ${isBot ? 'items-start' : 'items-end'}">
      <span class="text-[10px] md:text-xs font-bold tracking-wide text-slate-500 mb-1 md:mb-2 ml-1 uppercase">${isBot ? 'NEXA' : 'YOU'}</span>
      <div class="group relative">
        <div class="prose prose-invert text-sm md:text-[15px] p-4 md:p-5 rounded-2xl shadow-sm ${
          isBot 
            ? 'bg-slate-800/50 border border-white/5 text-slate-200 backdrop-blur-sm rounded-tl-none' 
            : 'bg-indigo-600 text-white rounded-tr-none shadow-lg shadow-indigo-500/10'
        }">
          <div class="leading-relaxed break-words">${content}</div>
        </div>
        <div class="absolute top-full ${isBot ? 'left-0' : 'right-0'} mt-1 hidden md:flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
          <button onclick="copyToClipboard(this)" class="p-1.5 rounded-lg bg-slate-800/50 hover:bg-slate-700 text-slate-400 hover:text-white text-xs border border-white/5" title="Copy"><i class="fa-regular fa-copy"></i></button>
        </div>
      </div>
    </div>
  `;

  chatContainer.appendChild(div);
  scrollToBottom();
}

function copyToClipboard(btn) {
  const group = btn.closest('.group');
  const messageBubble = group.querySelector('.prose');
  navigator.clipboard.writeText(messageBubble.innerText);
  const icon = btn.querySelector('i');
  icon.className = 'fa-solid fa-check text-emerald-400';
  setTimeout(() => icon.className = 'fa-regular fa-copy', 2000);
}

document.getElementById('chat-form').addEventListener('submit', async e => {
  e.preventDefault();
  const input = document.getElementById('user-input');
  const msg = input.value.trim();
  if(!msg) return;

  addMessage(msg, 'user');
  input.value = '';
  input.focus(); // Keep keyboard open

  conversation.push({ role:'user', content: msg });
  showTyping();

  try {
    const res = await fetch(API_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ history: conversation })
    });

    const data = await res.json();
    hideTyping();
    addMessage(data.reply, 'bot');
    conversation.push({ role:'assistant', content: data.reply });
  } catch(err) {
    hideTyping();
    addMessage('**Connection Error:** Unable to reach Nexa servers.', 'bot');
  }
});
</script>
</body>
</html>
