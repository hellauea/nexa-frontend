<!-- ================= FRONTEND : index.html ================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NEXA CORE</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen flex flex-col items-center justify-center">

<div class="w-full max-w-3xl bg-gray-900 p-4 rounded-lg shadow-lg">
  <h1 class="text-2xl font-bold text-cyan-400 mb-4">NEXA CORE</h1>
  
  <div id="chat" class="space-y-3 h-96 overflow-y-auto mb-4"></div>

  <form id="chat-form" class="flex gap-2">
    <input id="user-input" type="text" placeholder="Ask Nexa..." class="flex-1 p-2 rounded bg-black border border-cyan-400" />
    <button class="bg-cyan-400 text-black px-4 rounded">Send</button>
  </form>
</div>

<script>
const API_URL = "https://nexa-ai-nd5x.onrender.com/ask";
let conversation = [];

function addMessage(text, sender) {
  const div = document.createElement('div');
  div.className = sender === 'user' ? 'text-right' : 'text-left';
  div.innerHTML = `
    <div class="inline-block p-2 rounded bg-gray-800 border border-cyan-500">
      ${text}
      ${sender === 'bot' && text.includes('<code>') ? '<button onclick="copyCode(this)" class="ml-2 text-xs bg-cyan-500 px-2 py-1 rounded">Copy</button>' : ''}
    </div>`;
  document.getElementById('chat').appendChild(div);
}

function copyCode(btn) {
  const code = btn.parentElement.innerText.replace('Copy','').trim();
  navigator.clipboard.writeText(code);
  btn.innerText = 'Copied';
}

document.getElementById('chat-form').addEventListener('submit', async e => {
  e.preventDefault();
  const input = document.getElementById('user-input');
  const msg = input.value.trim();
  if(!msg) return;

  addMessage(msg, 'user');
  input.value = '';

  conversation.push({ role:'user', content: msg });

  try {
    const res = await fetch(API_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ history: conversation })
    });

    const data = await res.json();
    addMessage(data.reply, 'bot');
    conversation.push({ role:'assistant', content: data.reply });
  } catch(err) {
    addMessage('Connection error', 'bot');
  }
});
</script>
</body>
</html>


<!-- ================= BACKEND : server.js ================= -->
const express = require('express');
const cors = require('cors');
const fetch = require('node-fetch');

const app = express();
app.use(cors());
app.use(express.json());

const API_KEY = process.env.API_KEY;

const SYSTEM_PROMPT = `You are Nexa, a cybersecurity assistant created by a student studying cybersecurity at REVA University.
Always call yourself Nexa.
Be friendly, smart and helpful.
Remember previous conversation context.
When giving code, format it in code blocks.`;

app.get('/', (req,res)=> res.send('Nexa Backend Working'));

app.post('/ask', async(req,res)=>{
 try{
  const history = req.body.history || [];

  const formatted = history.map(m => ({
    role: m.role === 'user' ? 'user' : 'model',
    parts:[{text: m.content}]
  }));

  formatted.unshift({ role: 'user', parts:[{text:SYSTEM_PROMPT}] });

  const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ contents: formatted })
  });

  const data = await response.json();
  const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response';
  res.json({ reply });
 }
 catch(e){
  res.status(500).json({reply:'Server Error'});
 }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT,()=>console.log('Nexa running on',PORT));
